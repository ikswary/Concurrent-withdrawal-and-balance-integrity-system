# 통합 테스트 결과

## 요약

- **테스트 환경**: PostgreSQL 16, Redis 7, Spring Boot 3.2.1
- **테스트 일시**: 2025-12-19
- **전체 결과**: 6개 테스트 모두 통과 ✅

## 테스트 결과

### 1. 동시 출금 테스트 (100 스레드)

**조건**
- 초기 잔액: 10,000
- 동시 스레드: 100개
- 출금액: 100 × 100회

**결과**

| 항목 | 예상 | 실제 | 상태 |
|------|------|------|------|
| 최종 잔액 | 0 | 0 | ✅ |
| 성공 건수 | 100 | 100 | ✅ |
| 실패 건수 | 0 | 0 | ✅ |
| 거래 기록 | 100 | 100 | ✅ |

**검증**: Race condition 없음, 데이터 무결성 유지

---

### 2. 잔액 부족 테스트

**조건**
- 초기 잔액: 5,000
- 동시 스레드: 100개
- 출금액: 100 × 100회

**결과**

| 항목 | 예상 | 실제 | 상태 |
|------|------|------|------|
| 최종 잔액 | 0 | 0 | ✅ |
| 성공 건수 | 50 | 50 | ✅ |
| 실패 건수 | 50 | 50 | ✅ |
| 거래 기록 | 50 | 50 | ✅ |

**검증**: 잔액 부족 시 정확히 거부, 초과 출금 없음

---

### 3. 멱등성 테스트

**조건**
- 초기 잔액: 10,000
- 동시 스레드: 100개
- **동일 transactionId 사용**
- 출금액: 100

**결과**

| 항목 | 예상 | 실제 | 상태 |
|------|------|------|------|
| 최종 잔액 | 9,900 | 9,900 | ✅ |
| 출금 실행 | 1회 | 1회 | ✅ |
| 거래 기록 | 1건 | 1건 | ✅ |
| 중복 처리 | 기존 반환 | 기존 반환 | ✅ |

**검증**: 동일 ID로 100번 요청해도 1번만 실행, 멱등성 완벽 보장

**핵심**: 락 내부에서 멱등성 체크 → Race condition 완전 방지

---

### 4. 동시성 제어 비교 테스트

**조건**
- 초기 잔액: 1,000
- 동시 스레드: 50개
- 출금액: 20 × 50회

**결과**

| 항목 | 락 없음 | 락 사용 |
|------|---------|---------|
| 최종 잔액 | ❌ 820 | ✅ 0 |
| 거래 기록 | ❌ 41건 | ✅ 50건 |
| 손실 건수 | ❌ 9건 | ✅ 0건 |
| 데이터 무결성 | ❌ 실패 | ✅ 성공 |

**검증**: 락 없이는 Lost Update 발생, 락 사용 시 완벽한 무결성 유지